<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Grist IA ‚Äì Auditor Conversacional</title>
<script src="https://docs.getgrist.com/grist-plugin-api.js"></script>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    padding: 12px;
  }
  textarea {
    width: 100%;
    min-height: 120px;
    background: #020617;
    color: #e5e7eb;
    border: 1px solid #334155;
    border-radius: 6px;
    padding: 8px;
    resize: vertical;
    pointer-events: auto;
  }
  button {
    margin-top: 8px;
    padding: 8px 14px;
    background: #f59e0b;
    color: #020617;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  pre {
    background: #020617;
    padding: 10px;
    font-size: 12px;
    white-space: pre-wrap;
    border-radius: 6px;
    border: 1px solid #334155;
    margin-top: 10px;
  }
</style>
</head>

<body>

<h3>üß† Auditor IA</h3>

<label>Prompt de an√°lisis (editable):</label>
<textarea id="prompt" spellcheck="true"></textarea>

<button id="analyzeBtn">Analizar tabla</button>

<pre id="result">Esperando an√°lisis‚Ä¶</pre>

<script>
let tableId = null;

/* üî¥ CLAVE: readOnly evita que Grist secuestre el foco */
grist.ready({ requiredAccess: 'readOnly' });

/* CONFIG PANEL DERECHO */
grist.on('configure', () => {
  grist.customSectionAPI.configure({
    settings: [{
      name: "tableId",
      label: "ID de la tabla",
      type: "text",
      placeholder: "ej: base_unica"
    }]
  });
});

grist.on('settings', (s) => {
  tableId = s?.tableId || null;
});

/* üî¥ CLAVE: forzar foco */
const prompt = document.getElementById("prompt");
prompt.addEventListener("mousedown", e => e.stopPropagation());
prompt.addEventListener("keydown", e => e.stopPropagation());
setTimeout(() => prompt.focus(), 300);

document.getElementById("analyzeBtn").onclick = async () => {
  if (!prompt.value.trim()) {
    alert("Escrib√≠ un prompt primero");
    return;
  }
  document.getElementById("result").textContent =
    "PROMPT ENVIADO:\n\n" + prompt.value;
};
</script>

</body>
</html>
